<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ‰‹æœºç‰ˆä¿®å¤æµ‹è¯• - è™šæ‹ŸåŠ¨ç‰©å›­</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* æµ‹è¯•æç¤ºæ¡ */
        .test-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #FF69B4, #FFB6C1);
            color: white;
            text-align: center;
            padding: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: bold;
            z-index: 10000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* ä¸ºæµ‹è¯•æ¨ªå¹…ç•™å‡ºç©ºé—´ */
        body.mobile-version #app {
            margin-top: 35px;
            height: calc(100vh - 35px);
            height: calc(calc(var(--vh, 1vh) * 100) - 35px);
        }
        
        /* è°ƒæ•´åˆ‡æ¢å™¨ä½ç½® */
        .version-switcher {
            top: 45px !important;
        }
        
        .theme-switcher {
            top: 45px !important;
        }
        
        /* ç§»åŠ¨ç«¯æŒ‡ç¤ºå™¨ */
        .mobile-indicator {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,105,180,0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            z-index: 9998;
            backdrop-filter: blur(10px);
        }
        
        /* å±å¹•å°ºå¯¸æ˜¾ç¤º */
        .screen-info {
            position: fixed;
            top: 50px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 9px;
            z-index: 9999;
        }
    </style>
</head>
<body class="mobile-version">
    <!-- æµ‹è¯•æ¨ªå¹… -->
    <div class="test-banner">
        ğŸ“± æ‰‹æœºç‰ˆä¿®å¤æµ‹è¯• - çœŸæ­£çš„ç§»åŠ¨ç«¯é€‚é…ä½“éªŒ
    </div>
    
    <!-- å±å¹•ä¿¡æ¯æ˜¾ç¤º -->
    <div class="screen-info" id="screen-info">
        å±å¹•: åŠ è½½ä¸­...
    </div>
    
    <!-- ç§»åŠ¨ç«¯æŒ‡ç¤ºå™¨ -->
    <div class="mobile-indicator">
        ğŸ“± æ‰‹æœºç‰ˆæ¨¡å¼ - å·²ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ
    </div>
    
    <div id="app">
        <!-- ä¸»å¯¼èˆª -->
        <nav class="main-nav" role="tablist" aria-label="ä¸»è¦å¯¼èˆª">
            <button class="nav-tab active" data-tab="my-zoo" role="tab" aria-selected="true" aria-controls="my-zoo" tabindex="0">æˆ‘çš„åŠ¨ç‰©å›­</button>
            <button class="nav-tab" data-tab="growth-progress" role="tab" aria-selected="false" aria-controls="growth-progress" tabindex="-1">æˆé•¿è¿›åº¦</button>
            <button class="nav-tab" data-tab="animal-encyclopedia" role="tab" aria-selected="false" aria-controls="animal-encyclopedia" tabindex="-1">åŠ¨ç‰©å›¾é‰´</button>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- æˆ‘çš„åŠ¨ç‰©å›­é¡µé¢ -->
            <section id="my-zoo" class="tab-content active" role="tabpanel" aria-labelledby="my-zoo-tab">
                <div class="weather-selector">
                    <h3>ä»Šå¤©çš„å¤©æ°”</h3>
                    
                    <!-- å¿ƒæƒ…æè¿°è¾“å…¥ -->
                    <div class="mood-input-section">
                        <div class="mood-input-container">
                            <input type="text" id="mood-description" placeholder="ç”¨ä¸€å¥è¯æè¿°ä½ ä»Šå¤©çš„å¿ƒæƒ…..." maxlength="100">
                            <button id="analyze-mood-btn">åˆ†æå¿ƒæƒ…</button>
                        </div>
                    </div>
                    
                    <!-- å¤©æ°”æŒ‰é’® -->
                    <div class="weather-buttons">
                        <button class="weather-btn" data-weather="sunny">â˜€ï¸ æ™´æœ—</button>
                        <button class="weather-btn" data-weather="cloudy">â˜ï¸ å¤šäº‘</button>
                        <button class="weather-btn" data-weather="rainy">ğŸŒ§ï¸ é›¨å¤©</button>
                        <button class="weather-btn" data-weather="stormy">â›ˆï¸ æš´é£é›¨</button>
                    </div>
                </div>

                <div class="animals-container">
                    <!-- ç¤ºä¾‹åŠ¨ç‰©å¡ç‰‡ -->
                    <div class="animal-card" data-animal-type="cat">
                        <div class="animal-image-container">
                            <img src="https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=200&h=200&fit=crop&crop=face" alt="å°çŒ«å’ª" class="animal-photo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="animal-emoji-fallback" style="display: none;">ğŸ±</div>
                        </div>
                        <div class="animal-info">
                            <h4>å°çŒ«å’ª</h4>
                            <p class="growth-stage">å°‘å¹´é˜¶æ®µ</p>
                            <p class="task-count">ä»Šæ—¥ä»»åŠ¡: 2/3</p>
                            <p class="gentle-tip">ä»£è¡¨è‡ªæˆ‘å…³æ€€å’Œæ¸©æŸ”å¯¹å¾…è‡ªå·±</p>
                        </div>
                    </div>
                    
                    <div class="animal-card" data-animal-type="fox">
                        <div class="animal-image-container">
                            <img src="https://images.unsplash.com/photo-1474511320723-9a56873867b5?w=200&h=200&fit=crop&crop=face" alt="å°ç‹ç‹¸" class="animal-photo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="animal-emoji-fallback" style="display: none;">ğŸ¦Š</div>
                        </div>
                        <div class="animal-info">
                            <h4>å°ç‹ç‹¸</h4>
                            <p class="growth-stage">å¹¼å´½é˜¶æ®µ</p>
                            <p class="task-count">ä»Šæ—¥ä»»åŠ¡: 1/3</p>
                            <p class="gentle-tip">ä»£è¡¨æƒ…ç»ªè¡¨è¾¾ã€å¿ƒç†å¥åº·ã€å‹åŠ›ç®¡ç†</p>
                        </div>
                    </div>
                    
                    <div class="animal-card" data-animal-type="rabbit">
                        <div class="animal-image-container">
                            <img src="https://images.unsplash.com/photo-1585110396000-c9ffd4e4b308?w=200&h=200&fit=crop&crop=face" alt="å°å…”å­" class="animal-photo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="animal-emoji-fallback" style="display: none;">ğŸ°</div>
                        </div>
                        <div class="animal-info">
                            <h4>å°å…”å­</h4>
                            <p class="growth-stage">å¹¼å´½é˜¶æ®µ</p>
                            <p class="task-count">ä»Šæ—¥ä»»åŠ¡: 0/3</p>
                            <p class="gentle-tip">ä»£è¡¨åˆ›é€ åŠ›å’Œè‰ºæœ¯è¡¨è¾¾</p>
                        </div>
                    </div>
                </div>

                <!-- é€šç”¨å¯¹è¯æ¡† -->
                <div class="general-chat-section">
                    <h3>ğŸ’¬ å’ŒåŠ¨ç‰©æœ‹å‹ä»¬èŠèŠ</h3>
                    <div class="chat-preview">
                        <div class="chat-input-simple">
                            <input type="text" id="general-chat-input" placeholder="è¯´è¯´ä½ ä»Šå¤©çš„æƒ³æ³•..." maxlength="200">
                            <button id="general-chat-btn">å‘é€</button>
                        </div>
                        <div class="chat-hint">
                            <p>ğŸ’¡ æç¤ºï¼šèŠå¤©æ—¶æåˆ°ä¸åŒè¯é¢˜å¯èƒ½ä¼šè§£é”æ–°çš„åŠ¨ç‰©æœ‹å‹å“¦ï¼</p>
                        </div>
                    </div>
                </div>

                <button class="add-task-btn">+</button>
                <button class="chat-btn">è¯¦ç»†èŠå¤©</button>
            </section>

            <!-- æˆé•¿è¿›åº¦é¡µé¢ -->
            <section id="growth-progress" class="tab-content" role="tabpanel" aria-labelledby="growth-progress-tab">
                <h2>æˆé•¿è¿›åº¦</h2>
                
                <!-- ä»»åŠ¡æ€»è§ˆåŒºåŸŸ -->
                <div class="tasks-overview-section">
                    <h3>ğŸ“‹ ä»»åŠ¡æ€»è§ˆ</h3>
                    
                    <!-- ä»»åŠ¡ç»Ÿè®¡ -->
                    <div class="tasks-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="total-tasks">12</div>
                            <div class="stat-label">æ€»ä»»åŠ¡</div>
                        </div>
                        <div class="stat-card completed">
                            <div class="stat-number" id="completed-tasks">8</div>
                            <div class="stat-label">å·²å®Œæˆ</div>
                        </div>
                        <div class="stat-card pending">
                            <div class="stat-number" id="pending-tasks">3</div>
                            <div class="stat-label">è¿›è¡Œä¸­</div>
                        </div>
                        <div class="stat-card deleted">
                            <div class="stat-number" id="deleted-tasks">1</div>
                            <div class="stat-label">å·²åˆ é™¤</div>
                        </div>
                    </div>
                    
                    <!-- ä»»åŠ¡ç­›é€‰ -->
                    <div class="tasks-filter">
                        <button class="filter-btn active" data-filter="all">å…¨éƒ¨ä»»åŠ¡</button>
                        <button class="filter-btn" data-filter="pending">è¿›è¡Œä¸­</button>
                        <button class="filter-btn" data-filter="completed">å·²å®Œæˆ</button>
                        <button class="filter-btn" data-filter="deleted">å·²åˆ é™¤</button>
                    </div>
                    
                    <!-- ä»»åŠ¡åˆ—è¡¨ -->
                    <div class="all-tasks-list" id="all-tasks-list">
                        <!-- ç¤ºä¾‹ä»»åŠ¡é¡¹ -->
                        <div class="overview-task-item completed">
                            <div class="task-animal-icon">ğŸ±</div>
                            <div class="overview-task-content">
                                <div class="overview-task-title">ç»™è‡ªå·±æ³¡ä¸€æ¯å–œæ¬¢çš„èŒ¶</div>
                                <div class="overview-task-meta">
                                    <span class="task-animal-name">å°çŒ«å’ª</span>
                                    <span class="task-zone-label">è‡ªæˆ‘å…³æ€€å›­åŒº</span>
                                    <span class="task-status-badge completed">å·²å®Œæˆ</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="overview-task-item pending">
                            <div class="task-animal-icon">ğŸ¦Š</div>
                            <div class="overview-task-content">
                                <div class="overview-task-title">å†™ä¸‹ç°åœ¨çš„æ„Ÿå—ï¼Œä¸åŠ è¯„åˆ¤</div>
                                <div class="overview-task-meta">
                                    <span class="task-animal-name">å°ç‹ç‹¸</span>
                                    <span class="task-zone-label">æƒ…ç»ªå…³æ€€å›­åŒº</span>
                                    <span class="task-status-badge pending">è¿›è¡Œä¸­</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="overview-task-item deleted">
                            <div class="task-animal-icon">ğŸ°</div>
                            <div class="overview-task-content">
                                <div class="overview-task-title">ç”»ä¸€å¹…ç®€å•çš„æ¶‚é¸¦</div>
                                <div class="overview-task-meta">
                                    <span class="task-animal-name">å°å…”å­</span>
                                    <span class="task-zone-label">åˆ›é€ åŠ›å›­åŒº</span>
                                    <span class="task-status-badge deleted">å·²åˆ é™¤</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æˆé•¿è¿›åº¦åŒºåŸŸ -->
                <div class="growth-progress-section">
                    <h3>ğŸ“ˆ åŠ¨ç‰©æˆé•¿è¿›åº¦</h3>
                    <div class="progress-container">
                        <div class="animal-progress">
                            <div class="animal-name">ğŸ± å°çŒ«å’ª</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 65%"></div>
                            </div>
                            <div class="progress-info">
                                <span class="progress-text">65%</span>
                                <span class="growth-stage">å°‘å¹´</span>
                            </div>
                            <div class="experience-info">
                                <small>ç»éªŒå€¼: 195 / 300</small>
                            </div>
                        </div>
                        
                        <div class="animal-progress">
                            <div class="animal-name">ğŸ¦Š å°ç‹ç‹¸</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 30%"></div>
                            </div>
                            <div class="progress-info">
                                <span class="progress-text">30%</span>
                                <span class="growth-stage">å¹¼å´½</span>
                            </div>
                            <div class="experience-info">
                                <small>ç»éªŒå€¼: 30 / 100</small>
                            </div>
                        </div>
                        
                        <div class="animal-progress">
                            <div class="animal-name">ğŸ° å°å…”å­</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 10%"></div>
                            </div>
                            <div class="progress-info">
                                <span class="progress-text">10%</span>
                                <span class="growth-stage">å¹¼å´½</span>
                            </div>
                            <div class="experience-info">
                                <small>ç»éªŒå€¼: 10 / 100</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- åŠ¨ç‰©å›¾é‰´é¡µé¢ -->
            <section id="animal-encyclopedia" class="tab-content" role="tabpanel" aria-labelledby="animal-encyclopedia-tab">
                <h2>åŠ¨ç‰©å›¾é‰´</h2>
                <div class="encyclopedia-grid">
                    <!-- ç¤ºä¾‹å›¾é‰´å¡ç‰‡ -->
                    <div class="encyclopedia-card" data-animal-type="cat">
                        <div class="encyclopedia-animal-image">
                            <img src="https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=200&h=200&fit=crop&crop=face" alt="å°çŒ«å’ª" class="encyclopedia-photo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="encyclopedia-emoji-fallback" style="display: none;">ğŸ±</div>
                        </div>
                        <h4>å°çŒ«å’ª</h4>
                        <p>ä»£è¡¨è‡ªæˆ‘å…³æ€€å’Œæ¸©æŸ”å¯¹å¾…è‡ªå·±</p>
                        <span class="status owned">å·²æ‹¥æœ‰</span>
                        <button class="view-tarot-btn">æŸ¥çœ‹å¡”ç½—ç‰Œ</button>
                    </div>
                    
                    <div class="encyclopedia-card" data-animal-type="fox">
                        <div class="encyclopedia-animal-image">
                            <img src="https://images.unsplash.com/photo-1474511320723-9a56873867b5?w=200&h=200&fit=crop&crop=face" alt="å°ç‹ç‹¸" class="encyclopedia-photo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="encyclopedia-emoji-fallback" style="display: none;">ğŸ¦Š</div>
                        </div>
                        <h4>å°ç‹ç‹¸</h4>
                        <p>ä»£è¡¨æƒ…ç»ªè¡¨è¾¾ã€å¿ƒç†å¥åº·ã€å‹åŠ›ç®¡ç†</p>
                        <span class="status owned">å·²æ‹¥æœ‰</span>
                        <button class="view-tarot-btn">æŸ¥çœ‹å¡”ç½—ç‰Œ</button>
                    </div>
                    
                    <div class="encyclopedia-card locked" data-animal-type="deer">
                        <div class="encyclopedia-animal-image">
                            <img src="https://via.placeholder.com/200x200/cccccc/666666?text=?" alt="???" class="encyclopedia-photo">
                            <div class="encyclopedia-emoji-fallback" style="display: none;">â“</div>
                        </div>
                        <h4>???</h4>
                        <p>å®Œæˆç›¸å…³ä»»åŠ¡è§£é”</p>
                        <span class="status locked">æœªè§£é”</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="js/config.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/chatManager.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // æ‰‹æœºç‰ˆä¿®å¤æµ‹è¯•è„šæœ¬
        document.addEventListener('DOMContentLoaded', () => {
            console.log('æ‰‹æœºç‰ˆä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // æ˜¾ç¤ºå±å¹•ä¿¡æ¯
            function updateScreenInfo() {
                const screenInfo = document.getElementById('screen-info');
                if (screenInfo) {
                    const width = window.innerWidth;
                    const height = window.innerHeight;
                    const ratio = (width / height).toFixed(2);
                    screenInfo.textContent = `å±å¹•: ${width}Ã—${height} (${ratio})`;
                }
            }
            
            updateScreenInfo();
            window.addEventListener('resize', updateScreenInfo);
            window.addEventListener('orientationchange', () => {
                setTimeout(updateScreenInfo, 100);
            });
            
            // è®¾ç½®è§†å£é«˜åº¦å˜é‡
            const setVH = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
                console.log('è§†å£é«˜åº¦å·²æ›´æ–°:', vh);
            };
            
            setVH();
            window.addEventListener('resize', setVH);
            window.addEventListener('orientationchange', () => {
                setTimeout(setVH, 100);
            });
            
            // ç®€å•çš„å¯¼èˆªåˆ‡æ¢åŠŸèƒ½
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                    e.target.classList.add('active');
                    const targetId = e.target.dataset.tab;
                    document.getElementById(targetId).classList.add('active');
                    
                    console.log('åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ:', targetId);
                });
            });
            
            // ç®€å•çš„ç­›é€‰åŠŸèƒ½
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    const filter = e.target.dataset.filter;
                    console.log('ä»»åŠ¡ç­›é€‰:', filter);
                    
                    // ç®€å•çš„ç­›é€‰é€»è¾‘
                    const tasks = document.querySelectorAll('.overview-task-item');
                    tasks.forEach(task => {
                        if (filter === 'all') {
                            task.style.display = 'flex';
                        } else {
                            task.style.display = task.classList.contains(filter) ? 'flex' : 'none';
                        }
                    });
                });
            });
            
            // æ·»åŠ è§¦æ‘¸åé¦ˆ
            document.addEventListener('touchstart', function(e) {
                if (e.target.matches('button, .nav-tab, .animal-card, .filter-btn')) {
                    e.target.style.transform = 'scale(0.95)';
                }
            }, {passive: true});
            
            document.addEventListener('touchend', function(e) {
                if (e.target.matches('button, .nav-tab, .animal-card, .filter-btn')) {
                    setTimeout(() => {
                        e.target.style.transform = '';
                    }, 100);
                }
            }, {passive: true});
            
            // é˜²æ­¢åŒå‡»ç¼©æ”¾
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            console.log('æ‰‹æœºç‰ˆä¼˜åŒ–åŠŸèƒ½å·²å¯ç”¨');
        });
    </script>
</body>
</html>