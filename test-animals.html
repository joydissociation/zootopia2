<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>虚拟动物园 - 动物解锁测试</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="app">
        <!-- 像素风格装饰元素 -->
        <div class="pixel-decoration"></div>
        <div class="pixel-decoration"></div>
        <div class="pixel-decoration"></div>
        <div class="pixel-decoration"></div>
        
        <!-- 测试说明 -->
        <div style="background: #FFE4B5; border: 3px solid #DEB887; padding: 20px; margin-bottom: 20px; text-align: center;">
            <h2 style="margin: 0 0 10px 0; color: #8B4513;">🧪 动物解锁 + 塔罗牌收集测试</h2>
            <p style="margin: 0; font-family: 'Courier New', monospace; font-size: 12px; color: #8B4513;">
                <strong>解锁动物</strong>：在通用对话框中输入关键词<br>
                <strong>查看塔罗牌</strong>：在动物图鉴页面点击"查看塔罗牌"按钮<br>
                <strong>心情分析</strong>：在心情天气区域输入心情描述，系统会分析对应天气
            </p>
        </div>
        
        <!-- 主导航 -->
        <nav class="main-nav" role="tablist" aria-label="主要导航">
            <button class="nav-tab active" data-tab="my-zoo" role="tab" aria-selected="true" aria-controls="my-zoo" tabindex="0">我的动物园</button>
            <button class="nav-tab" data-tab="growth-progress" role="tab" aria-selected="false" aria-controls="growth-progress" tabindex="-1">成长进度</button>
            <button class="nav-tab" data-tab="animal-encyclopedia" role="tab" aria-selected="false" aria-controls="animal-encyclopedia" tabindex="-1">动物图鉴</button>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 我的动物园页面 -->
            <section id="my-zoo" class="tab-content active" role="tabpanel" aria-labelledby="my-zoo-tab">
                <div class="weather-selector">
                    <h3>今天的心情天气</h3>
                    <div class="weather-buttons">
                        <button class="weather-btn" data-weather="sunny">☀️ 晴朗</button>
                        <button class="weather-btn" data-weather="cloudy">☁️ 多云</button>
                        <button class="weather-btn" data-weather="rainy">🌧️ 雨天</button>
                        <button class="weather-btn" data-weather="stormy">⛈️ 暴风雨</button>
                    </div>
                </div>

                <div class="animals-container">
                    <!-- 动物卡片将通过JavaScript动态生成 -->
                </div>

                <!-- 通用对话框 -->
                <div class="general-chat-section">
                    <h3>💬 和动物朋友们聊聊</h3>
                    <div class="chat-preview">
                        <div class="chat-input-simple">
                            <input type="text" id="general-chat-input" placeholder="说说你今天的想法..." maxlength="200">
                            <button id="general-chat-btn">发送</button>
                        </div>
                        <div class="chat-hint">
                            <p>💡 提示：聊天时提到不同话题可能会解锁新的动物朋友哦！</p>
                        </div>
                    </div>
                </div>

                <button class="add-task-btn">+</button>
                <button class="chat-btn">详细聊天</button>
            </section>

            <!-- 成长进度页面 -->
            <section id="growth-progress" class="tab-content" role="tabpanel" aria-labelledby="growth-progress-tab">
                <h2>成长进度</h2>
                <div class="progress-container">
                    <!-- 进度将通过JavaScript动态生成 -->
                </div>
            </section>

            <!-- 动物图鉴页面 -->
            <section id="animal-encyclopedia" class="tab-content" role="tabpanel" aria-labelledby="animal-encyclopedia-tab">
                <h2>动物图鉴</h2>
                <div class="encyclopedia-grid">
                    <!-- 动物图鉴卡片将通过JavaScript动态生成 -->
                </div>
            </section>
        </main>

        <!-- 任务创建模态框 -->
        <div id="task-modal" class="modal hidden">
            <div class="modal-content">
                <h3>创建新任务</h3>
                <form id="task-form">
                    <input type="text" id="task-title" placeholder="任务标题" required>
                    <textarea id="task-description" placeholder="任务描述（可选）"></textarea>
                    <select id="garden-zone" required>
                        <option value="">选择园区</option>
                        <option value="self-care">自我关怀园区</option>
                        <option value="physical">身体健康园区</option>
                        <option value="emotional">情绪关怀园区</option>
                        <option value="creative">创造力园区</option>
                        <option value="social">社交连接园区</option>
                        <option value="organization">生活整理园区</option>
                        <option value="rest">休息放松园区</option>
                    </select>
                    <div class="modal-buttons">
                        <button type="button" class="cancel-btn">取消</button>
                        <button type="submit" class="create-btn">创建</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 聊天模态框 -->
        <div id="chat-modal" class="modal hidden">
            <div class="modal-content chat-content">
                <!-- 聊天头部 -->
                <div class="chat-header">
                    <h3 id="chat-title">🐱 和小猫咪聊聊</h3>
                    <div class="chat-controls">
                        <button id="settings-btn" class="settings-btn">⚙️ 设置</button>
                        <button class="close-chat-btn">✖️</button>
                    </div>
                </div>

                <!-- 动物选择（初始状态） -->
                <div class="animal-selection">
                    <p>选择一个动物朋友开始聊天：</p>
                    <div class="animal-grid">
                        <!-- 动物选择将通过JavaScript动态生成 -->
                    </div>
                </div>

                <!-- 聊天界面 -->
                <div class="chat-interface hidden">
                    <div class="chat-messages" id="chat-messages"></div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" placeholder="输入消息..." maxlength="200">
                        <button id="send-btn">发送</button>
                    </div>
                    <div class="chat-actions">
                        <button id="reflection-btn" class="action-btn">🤔 开始复盘</button>
                        <button id="clear-chat-btn" class="action-btn">🗑️ 清空聊天</button>
                    </div>
                </div>

                <!-- API配置面板 -->
                <div class="api-config-panel hidden">
                    <h4>🔧 API配置</h4>
                    <form id="api-config-form">
                        <div class="config-group">
                            <label for="api-url">API地址:</label>
                            <input type="url" id="api-url" placeholder="https://api.openai.com/v1/chat/completions" required>
                            <small>支持OpenAI兼容的API接口</small>
                        </div>
                        
                        <div class="config-group">
                            <label for="api-key">API密钥:</label>
                            <input type="password" id="api-key" placeholder="sk-..." required>
                            <small>你的API密钥将被安全存储</small>
                        </div>
                        
                        <div class="config-group">
                            <label for="model-name">模型名称:</label>
                            <input type="text" id="model-name" placeholder="gpt-3.5-turbo" required>
                            <small>如: gpt-3.5-turbo, gpt-4, claude-3等</small>
                        </div>
                        
                        <div class="config-actions">
                            <button type="button" id="test-api-btn" class="test-btn">🧪 测试连接</button>
                            <button type="submit" class="save-btn">💾 保存配置</button>
                        </div>
                    </form>
                    
                    <div class="config-status hidden" id="config-status"></div>
                    
                    <button id="back-to-chat-btn" class="back-btn">← 返回聊天</button>
                </div>
            </div>
        </div>

        <!-- 加载指示器 -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>加载中...</p>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/chatManager.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // 测试功能
        console.log('🧪 动物解锁测试页面已加载');
        console.log('已解锁的动物:', window.zooConfig.getUnlockedAnimals());
        
        // 添加测试按钮
        setTimeout(() => {
            const testSection = document.createElement('div');
            testSection.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                background: #FFD700;
                border: 3px solid #FFA500;
                padding: 15px;
                z-index: 1000;
            `;
            testSection.innerHTML = `
                <h4 style="margin: 0 0 10px 0; font-family: 'Courier New', monospace; color: #8B4513;">快速测试</h4>
                <button onclick="testUnlockAll()" style="margin: 2px; padding: 5px 10px; font-size: 10px; font-family: 'Courier New', monospace;">解锁所有动物</button><br>
                <button onclick="testResetAnimals()" style="margin: 2px; padding: 5px 10px; font-size: 10px; font-family: 'Courier New', monospace;">重置动物</button><br>
                <button onclick="testShowUnlocked()" style="margin: 2px; padding: 5px 10px; font-size: 10px; font-family: 'Courier New', monospace;">显示已解锁</button><br>
                <button onclick="testResetTarotCards()" style="margin: 2px; padding: 5px 10px; font-size: 10px; font-family: 'Courier New', monospace;">重置塔罗牌</button>
            `;
            document.body.appendChild(testSection);
        }, 1000);
        
        // 测试函数
        function testUnlockAll() {
            const animals = ['deer', 'fox', 'parrot', 'penguin', 'beaver', 'sloth'];
            animals.forEach(animal => {
                window.zooConfig.unlockAnimal(animal);
                app.showAnimalUnlockNotification(animal);
            });
            app.updateAnimalsDisplay();
            app.updateEncyclopediaDisplay();
        }
        
        function testResetAnimals() {
            localStorage.removeItem('unlockedAnimals');
            localStorage.removeItem('shownTarotCards'); // 重置塔罗牌显示状态
            app.updateAnimalsDisplay();
            app.updateEncyclopediaDisplay();
            console.log('动物已重置，只保留小猫咪');
        }
        
        function testShowUnlocked() {
            console.log('已解锁的动物:', window.zooConfig.getUnlockedAnimals());
            console.log('已显示过塔罗牌的动物:', window.zooConfig.getShownTarotCards());
        }
        
        function testResetTarotCards() {
            localStorage.removeItem('shownTarotCards');
            console.log('塔罗牌显示状态已重置');
        }
    </script>
</body>
</html>