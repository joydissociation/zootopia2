<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆé•¿è¿›åº¦æµ‹è¯•</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <h1>ğŸ¾ æˆé•¿è¿›åº¦æµ‹è¯•</h1>
        
        <div class="test-controls" style="margin: 20px 0; padding: 20px; background: #f0f8ff; border: 3px solid #4169e1;">
            <h3>æµ‹è¯•æ§åˆ¶</h3>
            <button id="unlock-fox-btn" style="margin: 5px; padding: 10px 15px; background: #32cd32; color: white; border: none; cursor: pointer;">è§£é”å°ç‹ç‹¸</button>
            <button id="unlock-deer-btn" style="margin: 5px; padding: 10px 15px; background: #32cd32; color: white; border: none; cursor: pointer;">è§£é”å°é¹¿</button>
            <button id="add-exp-btn" style="margin: 5px; padding: 10px 15px; background: #ffd700; color: #8b4513; border: none; cursor: pointer;">å¢åŠ ç»éªŒå€¼</button>
            <button id="reset-data-btn" style="margin: 5px; padding: 10px 15px; background: #ff6347; color: white; border: none; cursor: pointer;">é‡ç½®æ•°æ®</button>
            <button id="refresh-progress-btn" style="margin: 5px; padding: 10px 15px; background: #4169e1; color: white; border: none; cursor: pointer;">åˆ·æ–°è¿›åº¦</button>
        </div>

        <div class="debug-info" style="margin: 20px 0; padding: 15px; background: #f5f5f5; border: 2px solid #999; font-family: monospace; font-size: 12px;">
            <h4>è°ƒè¯•ä¿¡æ¯</h4>
            <div>å·²è§£é”åŠ¨ç‰©: <span id="unlocked-animals">åŠ è½½ä¸­...</span></div>
            <div>ç”¨æˆ·åŠ¨ç‰©æ•°é‡: <span id="user-animals-count">0</span></div>
            <div>æ•°æ®åº“çŠ¶æ€: <span id="db-status">æœªçŸ¥</span></div>
        </div>
        
        <main class="main-content">
            <section id="growth-progress" class="tab-content active">
                <h2>ğŸ“ˆ æˆé•¿è¿›åº¦</h2>
                <div class="progress-container">
                    <!-- è¿›åº¦æ¡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>
        </main>
    </div>

    <!-- è„šæœ¬åŠ è½½ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/chatManager.js"></script>
    <script src="js/app.js"></script>

    <script>
        let testApp;
        
        document.addEventListener('DOMContentLoaded', async () => {
            // åˆå§‹åŒ–åº”ç”¨
            testApp = new VirtualZooApp();
            
            // ç­‰å¾…åˆå§‹åŒ–å®Œæˆ
            await new Promise(resolve => {
                const checkInit = () => {
                    if (testApp.isInitialized) {
                        resolve();
                    } else {
                        setTimeout(checkInit, 100);
                    }
                };
                checkInit();
            });
            
            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            updateDebugInfo();
            
            // ç»‘å®šæµ‹è¯•æŒ‰é’®äº‹ä»¶
            document.getElementById('unlock-fox-btn').addEventListener('click', async () => {
                window.zooConfig.unlockAnimal('fox');
                if (testApp.dataManager.supabase) {
                    await testApp.dataManager.unlockAnimal('fox');
                }
                await testApp.loadUserData();
                await testApp.loadGrowthProgress();
                updateDebugInfo();
                console.log('å°ç‹ç‹¸å·²è§£é”');
            });
            
            document.getElementById('unlock-deer-btn').addEventListener('click', async () => {
                window.zooConfig.unlockAnimal('deer');
                if (testApp.dataManager.supabase) {
                    await testApp.dataManager.unlockAnimal('deer');
                }
                await testApp.loadUserData();
                await testApp.loadGrowthProgress();
                updateDebugInfo();
                console.log('å°é¹¿å·²è§£é”');
            });
            
            document.getElementById('add-exp-btn').addEventListener('click', async () => {
                // ä¸ºæ‰€æœ‰åŠ¨ç‰©å¢åŠ éšæœºç»éªŒå€¼
                for (let animal of testApp.userAnimals) {
                    animal.experience_points = (animal.experience_points || 0) + Math.floor(Math.random() * 50) + 10;
                    
                    if (testApp.dataManager.supabase) {
                        await testApp.dataManager.updateAnimalProgress(animal.id, animal.experience_points);
                    }
                }
                await testApp.loadGrowthProgress();
                updateDebugInfo();
                console.log('ç»éªŒå€¼å·²å¢åŠ ');
            });
            
            document.getElementById('reset-data-btn').addEventListener('click', () => {
                localStorage.removeItem('unlockedAnimals');
                localStorage.removeItem('shownTarotCards');
                localStorage.removeItem('zoo_user_id');
                alert('æœ¬åœ°æ•°æ®å·²é‡ç½®ï¼Œè¯·åˆ·æ–°é¡µé¢');
            });
            
            document.getElementById('refresh-progress-btn').addEventListener('click', async () => {
                await testApp.loadUserData();
                await testApp.loadGrowthProgress();
                updateDebugInfo();
                console.log('è¿›åº¦å·²åˆ·æ–°');
            });
            
            // åˆå§‹åŠ è½½è¿›åº¦
            await testApp.loadGrowthProgress();
        });
        
        function updateDebugInfo() {
            const unlockedAnimals = window.zooConfig.getUnlockedAnimals();
            document.getElementById('unlocked-animals').textContent = unlockedAnimals.join(', ');
            document.getElementById('user-animals-count').textContent = testApp.userAnimals ? testApp.userAnimals.length : 0;
            document.getElementById('db-status').textContent = testApp.dataManager.supabase ? 'å·²è¿æ¥' : 'æœ¬åœ°æ¨¡å¼';
            
            console.log('è°ƒè¯•ä¿¡æ¯æ›´æ–°:', {
                unlockedAnimals,
                userAnimals: testApp.userAnimals,
                dbStatus: testApp.dataManager.supabase ? 'å·²è¿æ¥' : 'æœ¬åœ°æ¨¡å¼'
            });
        }
    </script>
</body>
</html>
</text>